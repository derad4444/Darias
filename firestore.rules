rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ユーザー認証が必要な個人データ
    match /users/{userId} {
      // ユーザー自身のデータのみアクセス可能
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // ユーザーのサブコレクション（予定、日記など）
      match /{subcollection=**} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // 祝日データ - 全ユーザーが読み取り可能、書き込みは管理者のみ
    match /holidays/{holidayId} {
      allow read: if true;
      allow write: if false; // 管理者による手動更新のみ
    }

    // システム設定 - 読み取り専用
    match /system/{document} {
      allow read: if true;
      allow write: if false;
    }

    // Big5性格解析データ - 認証済みユーザーは読み取り可能、書き込みは不可（Cloud Functionのみ）
    match /Big5Analysis/{personalityKey} {
      allow read: if request.auth != null;
      allow write: if false;
    }

    // 全ての他のドキュメントはアクセス拒否
    match /{document=**} {
      allow read, write: if false;
    }
  }
}